<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function cdUpcomingEventsController($scope, $sce, $timeout, i18n, $window, cdAnalytics) {
	var c = this;
	
	$scope.cdAnalytics = cdAnalytics;

	$scope.clickAction = 'Event Clickthrough';
	c.i18n = i18n;
	c.i18n.loadMessage('show_upcoming_event', 'Show upcoming event {0}');
	c.i18n.loadMessage('hide_upcoming_event', 'Hide upcoming event {0}');
	
	c.loadData = function(callback) {
		c.server.get({action: 'loadData'}).then(callback);
	};

	c.toggleDetail = function(e, i) {
		e.preventDefault();
		
		if ($scope.togglingDetail)
			return;
		$scope.togglingDetail = true;
		
		// Prevent 'space' triggering two toggles
		$timeout(function() {
			$scope.togglingDetail = false;
		}, 500);
		
		var $panelCollapse = $(e.delegateTarget).closest('.panel-heading').next('.panel-collapse');
		
		// clear animation queue
		$panelCollapse.stop();
		$panelCollapse.clearQueue();
		
		// hide other opened panel
		if (c.lastOpenedPanel && c.lastOpenedPanelIndex != i)
			c.lastOpenedPanel.slideUp();
		
		// if user clicks the same panel, set index to -1
		c.lastOpenedPanelIndex = c.lastOpenedPanelIndex == i ? -1 : i;		
		c.lastOpenedPanel = $panelCollapse;
		
		$panelCollapse.slideToggle();
		
		if (!c.data.isContentPreview && c.lastOpenedPanelIndex >= 0 ) {
			// This event was opened
			var eItem = c.data.items[c.lastOpenedPanelIndex];
			cdAnalytics.trackEvent('Event Expand', eItem);
		}
		
		if (!$panelCollapse.hasClass('checked'))
			// add class "checked" to use as flag for single run
			// if element has an href and no target attribute, add target=_blank
			$panelCollapse.addClass('checked').find('*[href]').each(function openLinkInNewTab () {
				if (!this.getAttribute('target'))
					this.setAttribute('target', '_blank');
			});
	};

	c.displayItems = function(response) {
		c.data = response.data;
		
		if (!c.data.items)
			return;
		
		c.data.items.forEach(function(o) {
			o.html = $sce.trustAsHtml(o.rich_text);
			
			if (!c.data.isContentPreview)
				cdAnalytics.trackEvent('Event Impression', o);
		});

		c.data.items.sort(function(a, b) {
			var key = 'event_start_numeric';
			return a[key] < b[key] ? -1 : a[key] > b[key] ? 1 : 0;
		});

		if (c.data.items.length === 1)
			$timeout(c.slideToShow);
	};
	
	c.loadData(c.displayItems);
}]]></client_script>
        <controller_as>c</controller_as>
        <css>$preview-outline: #005B9D !default;&#13;
$preview-outline-inactive: #485563 !default;&#13;
$preview-outline-text-color: #FFFFFF !default;&#13;
&#13;
.upcoming-events-widget {&#13;
  /* Remove heading text while remaining WCAG-compliant */&#13;
  &amp;:not(.show-heading) {&#13;
    .panel {      &#13;
      .panel-heading {&#13;
        position: absolute;&#13;
        left: -9999px;&#13;
        top: -9999px;&#13;
      }&#13;
&#13;
      .panel {&#13;
        .panel-heading {&#13;
          position: relative;&#13;
          left: inherit;&#13;
          top: inherit;&#13;
        }&#13;
      }&#13;
    }&#13;
  }&#13;
  &#13;
  /* Remove bounding box style for outermost panel */ &#13;
  &amp;:not(.show-bounding-box) {&#13;
  	.panel {&#13;
      border-color: transparent;&#13;
      border-radius: 0;&#13;
      box-shadow: none;&#13;
      .panel {&#13;
        border-color: $color-lighter;&#13;
      }&#13;
    }&#13;
  }&#13;
  &amp;:not(.show-background) {&#13;
    .panel, .panel-heading, .panel-footer {&#13;
      background: none !important;&#13;
      border: none !important;&#13;
      box-shadow: none !important;&#13;
    }&#13;
  }&#13;
}&#13;
&#13;
.upcoming-list{&#13;
	list-style : none;&#13;
  padding-left : 0;&#13;
  margin-bottom : 0;&#13;
}&#13;
.event-date {&#13;
  display: none;&#13;
}&#13;
img {&#13;
  width: 100%; height: auto;&#13;
}&#13;
.heading-text&#13;
{&#13;
  padding-top:2px;&#13;
  p:not(.addToCalendar) {&#13;
    color : #1F8476;&#13;
    width: fit-content;&#13;
  }&#13;
}&#13;
.row-line-space {&#13;
  display:inline-block;&#13;
  padding-top:4px;&#13;
  padding-bottom:4px;&#13;
  color: $color-darker;&#13;
}&#13;
.panel-footer&#13;
{&#13;
  background-color: $color-lightest;&#13;
  padding: 3px 15px; }&#13;
.panel &gt; .panel-body {&#13;
  padding: 0;&#13;
  &#13;
  .panel-group {&#13;
    margin-bottom: 0;&#13;
  }&#13;
  .panel {&#13;
    border-bottom: 0;&#13;
    border-color: none;&#13;
    border-left: 0;&#13;
    border-radius: 0;&#13;
    border-right: 0;&#13;
    box-shadow: none;&#13;
    &amp;:first-child {&#13;
      border-top: none;&#13;
    }&#13;
    .panel-heading {&#13;
      background: none;&#13;
      border-radius: none;&#13;
      border: 1px solid transparent;&#13;
    }&#13;
    .preview-outline {&#13;
      border: 3px solid $preview-outline;&#13;
    }&#13;
  }&#13;
  .remove-margin {&#13;
    margin-top:0px;&#13;
    margin-bottom:0px;&#13;
  }&#13;
  .date {&#13;
    @extend .remove-margin {&#13;
      margin-top:112px;&#13;
    }&#13;
  }&#13;
  .start-date-label, .end-date-label {&#13;
  	margin-bottom:0;&#13;
  }&#13;
  #calIcon {&#13;
    margin-right:3px;&#13;
  }&#13;
  .eventsCal {&#13;
    float:right;&#13;
    font-size:normal;&#13;
    font-family: inherit;&#13;
    color: $primary;&#13;
    padding: 5px 0px 0px 0px;&#13;
  }&#13;
  .hr-override {&#13;
    margin-top:5px!important;&#13;
    margin-bottom:5px !important;&#13;
  }&#13;
  .sn-download-link {&#13;
    margin:0;&#13;
    font-size:1.4rem;&#13;
    font-weight:normal;&#13;
    display:inline-block;&#13;
  }&#13;
}&#13;
.addToCalendar {&#13;
  color: #03498e;&#13;
}&#13;
&#13;
.preview-outline {&#13;
  border: 3px solid $preview-outline;&#13;
}&#13;
&#13;
.preview-info-tab {&#13;
  background-color: $preview-outline;&#13;
}&#13;
&#13;
.preview-info-container {&#13;
  z-index: auto;&#13;
}&#13;
&#13;
.preview-info-container-compact {&#13;
  background-color: $preview-outline;&#13;
  z-index: auto;&#13;
}&#13;
&#13;
.preview-info-tab-compact {&#13;
  background-color: $preview-outline;&#13;
}&#13;
&#13;
.preview-info-popup {&#13;
  color: $preview-outline-text-color !important;&#13;
}&#13;
&#13;
.preview-info-tab-text {&#13;
  color: $preview-outline-text-color;&#13;
}&#13;
&#13;
.preview-outline-inactive {&#13;
  border: 3px solid $preview-outline-inactive !important;&#13;
&#13;
  .preview-info-tab {&#13;
    background-color: $preview-outline-inactive !important;&#13;
  }&#13;
&#13;
  .preview-info-container-compact {&#13;
    background-color: $preview-outline-inactive !important;&#13;
  }&#13;
&#13;
  .preview-info-tab-compact {&#13;
    background-color: $preview-outline-inactive !important;&#13;
  }&#13;
}&#13;
@media screen and (max-width: 420px) {&#13;
  .preview-info-item-section {&#13;
    	width: 200px;&#13;
  }&#13;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description>Displays portal content with Content type of Event. Used to show upcoming events.</description>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>ihr-upcoming-events</id>
        <internal>false</internal>
        <link><![CDATA[function eventCalendarLink (scope, elem, attr) {

	elem[0].onkeydown = function (e) {
		var $focused = $(document.activeElement);
		switch (e.keyCode) {
			case 37:
			case 38:
				if ($focused.prev().length)
					$focused.prev().focus();
				break;
			case 39:
			case 40:
				if ($focused.next().length)
					$focused.next().focus();
				break;
			case 13:
				// For IE
				if ($focused && !!document.documentMode && !/a/i.test($focused[0].tagName))
					$focused.click();
		}
	};

	scope.downloadAllEvents = function () {
		var spInstanceId = scope.data.spInstanceId;
		window.open("/sn_cd_downloadICS.do?sysparm_type=event&sysparm_sp_instance_id=" + spInstanceId);
		
		if (!scope.data.isContentPreview) {
			for(var i = 0; i < scope.data.items.length; i++) {
				var eItem = scope.data.items[i];
				scope.cdAnalytics.trackEvent('Event Download', eItem);
			}
		}
	};

	scope.downloadIndividualEvent = function(sysId, idx) {
		var eItem = scope.data.items[idx];
		
		if (!scope.data.isContentPreview)
			scope.cdAnalytics.trackEvent('Event Download', eItem);
		
		window.open("/sn_cd_downloadICS.do?sysparm_type=event&sysparm_sys_id=" + sysId);
	};
}]]></link>
        <name>iHR Upcoming Events (CD)</name>
        <option_schema>[{"name":"displayHeadingText","section":"other","default_value":"true","label":"Display Heading Text","type":"boolean"},&#13;
{"name":"displayBoundingBox","section":"other","default_value":"true","label":"Display Bounding Box","type":"boolean"},&#13;
{"name":"showBackground","section":"other","default_value":"true","label":"Display Widget Background Color","type":"boolean"}]</option_schema>
        <public>false</public>
        <roles>snc_internal,sn_asc.alumni</roles>
        <script><![CDATA[(function () {
	if (!input || input.action != "loadData")
		return;

	var grInstanceRecord = $sp.getInstanceRecord();
	// add sp_instance id to scope in case 'Add all to calendar' is clicked -- need to know which sp_instance events we are showing the user
	data.spInstanceId = grInstanceRecord.getUniqueValue();
	// Get options from sp instance to hide/show heading text
	data.displayHeadingText = options.displayHeadingText == 'true';
	// Get options from sp instance to hide/show bounding box style	
	data.displayBoundingBox = options.displayBoundingBox == 'true';
	// Get options from sp instance to hide/show the background
	data.showBackground = options.showBackground == 'true';
	data.messages = {
		'addToCalendarLabel': gs.getMessage('Add {0} to calendar'), // {0} is the event to add
		'openUpcomingEventLabel': gs.getMessage('Open upcoming event {0}')
	};
console.log("asjdgshdgjhasd"+$sp);
	// data.isContentPreview = sn_hr_sp.cd_ContentDelivery.isContentPreview($sp);
	var contentArray = sn_hr_sp.cd_ContentDelivery.getContent($sp);
	gs.info("asdkls {0}", contentArray);

	for (var i = 0; i < contentArray.length; i++) {
		if (!contentArray[i].event_start)
			continue;
		var startDateTime = new GlideDateTime(contentArray[i].event_start);
		var startDate = startDateTime.getLocalDate();
		var startDayAbv = gs.getMessage(startDate.getByFormat('EEE'));
		var startTime = startDateTime.getLocalTime().getByFormat('h:mm a');

		var endDateTime = new GlideDateTime(contentArray[i].event_end);
		var endDate = endDateTime.getLocalDate();
		var endDayAbv = gs.getMessage(endDate.getByFormat('EEE'));
		var endTime = endDateTime.getLocalTime().getByFormat('h:mm a');
		var onSingleDay = startDate.getByFormat('d') == endDate.getByFormat('d') && (GlideDate.subtract(startDate, endDate).getDayPart() == 0);
		
		var startMonth = gs.getMessage(startDate.getByFormat('MMM'));
		var startMonthAndDay =  startMonth + ' ' + startDate.getByFormat('d');
		if (onSingleDay) {
			contentArray[i].date_line_one = gs.getMessage("{0}, {1} {2} - {3}", [startDayAbv, startDate.getDisplayValue(), startTime, endTime]);
			contentArray[i].date_header = startMonthAndDay;
		} else {
			contentArray[i].date_line_one = gs.getMessage('{0}, {1} {2}', [startDayAbv, startDate.getDisplayValue(), startTime]);
			contentArray[i].date_line_two = gs.getMessage('{0}, {1} {2}', [endDayAbv, endDate.getDisplayValue(), endTime]);

			var endMonth = gs.getMessage(endDate.getByFormat('MMM'));
			var endMonthAndDay =  endMonth + ' ' + endDate.getByFormat('d');
			contentArray[i].date_header = gs.getMessage('{0} - {1}', [startMonthAndDay, endMonthAndDay]);
		}
		
		contentArray[i].event_start_numeric = startDateTime.getNumericValue();
	}
	
	data.items = contentArray;
	
	data.items.forEach(function(item) {
		var additionalDetails = [
			{ label: gs.getMessage('Portal Content'), value: 'Portal Event'},
			{ label: 'Event Start', value: item.event_start},
			{ label: 'Event End', value: item.event_end}
		];
		
		cd_ContentDelivery.setInfoObjectOnContentItem(item, additionalDetails);
	});	
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>vishnu.rai</sys_created_by>
        <sys_created_on>2021-09-21 08:19:28</sys_created_on>
        <sys_id>2d24ac641bb27850f639da09dc4bcb00</sys_id>
        <sys_mod_count>22</sys_mod_count>
        <sys_name>iHR Upcoming Events (CD)</sys_name>
        <sys_package display_value="Employee Center Core" source="sn_hr_sp">3d1da2705b021200a4656ede91f91ab6</sys_package>
        <sys_policy/>
        <sys_scope display_value="Employee Center Core">3d1da2705b021200a4656ede91f91ab6</sys_scope>
        <sys_update_name>sp_widget_2d24ac641bb27850f639da09dc4bcb00</sys_update_name>
        <sys_updated_by>vishnu.rai</sys_updated_by>
        <sys_updated_on>2021-09-24 08:31:51</sys_updated_on>
        <template><![CDATA[<section class="upcoming-events-widget"
         ng-class="[{'show-heading': c.data.displayHeadingText},
                   {'show-bounding-box': c.data.displayBoundingBox},
                   {'show-background': c.data.showBackground}]">
  <div ng-if="c.data.items.length" class="panel panel-{{::c.options.color}} b" rect="rect">
  <div class="panel-heading">
    <h3 class="h4 panel-title" ng-bind="::options.title" id="header-{{data.spInstanceId}}"></h3>
  </div>
  <div class="panel-body transclude">
    <div class="panel-group">
      <ul class="upcoming-list" aria-labelledby="header-{{data.spInstanceId}}">
      	<li class="panel upcoming-event-panel" ng-repeat="item in data.items track by $index">
          <div class="panel-heading" ng-class="{'preview-outline preview-info-container-parent': item.is_preview && item.is_content_active == 1, 'preview-outline-inactive preview-info-container-parent': item.is_preview && item.is_content_active == 0}" role="presentation">
            
            <portal-content-preview-info-tab is-compact="true" item="item" data="c.data" index="$index">
            </portal-content-preview-info-tab>
            
            <div class="heading-text">
              <div class="remove-margin h5">
                <p title="{{::item.title}}"
                  aria-expanded="{{c.lastOpenedPanelIndex === $index}}"
                  aria-controls="{{data.spInstanceId}}-panel-{{$index}}"
                  id="item-title-{{item.sys_id}}"
                  data-toggle="tooltip">
                  {{::item.title}}
                </p>
                <span class="pull-right" title="{{ c.lastOpenedPanelIndex === $index ? c.i18n.getMessage('hide_upcoming_event').withValues([item.title]) : c.i18n.getMessage('show_upcoming_event').withValues([item.title]) }}" data-toggle="tooltip">
                    <button alt="{{::item.date_header}}"
                      ng-class='["pull-right toggle fa", (c.lastOpenedPanelIndex === $index ? "fa-minus-square-o" : "fa-plus-square-o")]'
                      aria-expanded="{{c.lastOpenedPanelIndex === $index}}"
                      aria-describedby="date_header_{{$index}}"
                      aria-controls="{{data.spInstanceId}}-panel-{{$index}}"
                      role="button"
                      aria-label="{{ c.lastOpenedPanelIndex === $index ? c.i18n.getMessage('hide_upcoming_event').withValues([item.title]) : c.i18n.getMessage('show_upcoming_event').withValues([item.title]) }}"
                      style="border:none;"
                      ng-click="c.toggleDetail($event, $index)"
                            ></button>
                </span>
              </div>
              <span id="date_header_{{$index}}" class="date row-line-space">{{::item.date_header}}</span>
              <div ng-click="$event.stopPropagation()">
                <p class="addToCalendar"
                  ng-click="downloadIndividualEvent(item.sys_id, $index)"
                  aria-labelledby="item-title-{{item.sys_id}} add-to-cal-{{item.sys_id}}"
                  aria-label="Add to calendar : {{::item.title}}"
                  role="button"
                  tabindex="0">
                  <i class="fa fa-calendar-plus-o" aria-hidden="true"></i>
                  <span id="add-to-cal-{{item.sys_id}}">${Add to calendar}</span>
                </p>
              </div>
            </div>
          </div>
          <div class="panel-collapse collapse" id="{{data.spInstanceId}}-panel-{{$index}}">
            <div class="panel-body">
              <div class="panel panel-default" ng-if="item.url">
                <img alt="{{item.url}}" class="img-responsive" ng-src="{{item.url}}" src="{{item.url}}">
              </div>
              <p class="start-date-label" ng-if="item.date_line_two">
							  ${Starts:}
              </p>
              <p class="start-date">
                {{::item.date_line_one}}
              </p>
              <p class="end-date-label" ng-if="item.date_line_two">
                ${Ends:}
              </p>
              <p class="end-date">
                {{::item.date_line_two}}
              </p>
  
              <div cd-html html="{{::item.html}}" item="item" disable-tracking="c.data.isContentPreview" action="clickAction" />
            </div>
          </div>
        </li>
      </ul>      
    </div>
    <div class="panel-footer transclude" >
      <p class="eventsCal"
        ng-click="downloadAllEvents()"
        role="button" tabindex="0"
        aria-label="Add all Upcoming Events to calendar"
        aria-labelledby="header-{{data.spInstanceId}} add-all-to-cal-{{data.spInstanceId}}">
        <i id="calIcon" class="fa fa-calendar-plus-o" aria-hidden="true"></i>
        <span id="add-all-to-cal-{{data.spInstanceId}}">${Add all to calendar}</span>
      </p>
    </div>
    </div>
  </div>
</section>]]></template>
    </sp_widget>
    <sys_claim action="INSERT_OR_UPDATE">
        <claim_owner_scope display_value="Employee Center Core">3d1da2705b021200a4656ede91f91ab6</claim_owner_scope>
        <claim_timestamp>185c6dac2670000001</claim_timestamp>
        <metadata_update_name>sp_widget_2d24ac641bb27850f639da09dc4bcb00</metadata_update_name>
        <previous_claim_app_version>26.0.4</previous_claim_app_version>
        <previous_claim_name>Employee Center Core</previous_claim_name>
        <previous_claim_scope>3d1da2705b021200a4656ede91f91ab6</previous_claim_scope>
        <sys_created_by>sam.herring</sys_created_by>
        <sys_created_on>2023-01-18 21:48:23</sys_created_on>
        <sys_id>fdcef79c1b68e110f639da09dc4bcb3c</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>sam.herring</sys_updated_by>
        <sys_updated_on>2023-01-18 21:48:23</sys_updated_on>
    </sys_claim>
</record_update>
